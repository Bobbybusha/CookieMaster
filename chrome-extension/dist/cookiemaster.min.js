var CME={},CMEO={};CME.cacheStore={},CME.informations={items:[],bonus:[],bci:[],roi:[],timeLeft:[]},CME.milkPotentials={"Kitten helpers":.05,"Kitten workers":.1,"Kitten engineers":.2,"Kitten overseers":.2,"Santa's milk and cookies":.05},CME.getAchievementWorth=function(a,b,c,d){var e,f,g,h=0,i=0,j=this.getHeavenlyMultiplier(),k=Game.milkProgress;return"undefined"==typeof d&&(d=0),0!==d&&(j=d),Game.UpgradesById.forEach(function(a){a.bought&&a.matches("Cookie production multiplier <b>+")&&(j+=a.getDescribedInteger()),a.id===b&&a&&!a.bought&&a.matches("Cookie production multiplier <b>+")&&(i+=a.getDescribedInteger())}),e=this.applyMilkPotential(j,k),f=this.computeNewIncome(c,e),g=Game.UpgradesById[b].name,j+=i,k+=.04*a,e=this.applyMilkPotential(j,k,g),h=this.computeNewIncome(c,e),a=this.getUnlockedIncomeAchievements(h),a>0&&(k+=.04*a,e=this.applyMilkPotential(j,k,g),h=this.computeNewIncome(c,e)),0===d&&(h-=f),Game.Has("Elder Covenant")&&(h*=.95),h},CME.computeNewIncome=function(a,b){return(Game.cookiesPs+a)/Game.globalCpsMult*(b/100)*this.getFrenzyMultiplier()},CME.getUnlockedIncomeAchievements=function(a){var b=0;return Game.frenzyPower?0:(Game.AchievementsById.forEach(function(c){!c.won&&c.matches(" per second.")&&a>=c.getDescribedInteger()&&b++}),b)},CME.applyMilkPotential=function(a,b,c){var d,e,f=[];"undefined"==typeof b&&(b=Game.milkProgress);for(d in this.milkPotentials)e=Game.Has(d)||d===c,f.push(e*this.milkPotentials[d]);return a+=100,f.forEach(function(c){a*=1+c*b}),a},CME.getBestValue=function(a){return[Math[a].apply(Math,this.informations.bci),Math[a].apply(Math,this.informations.timeLeft),Math[a].apply(Math,this.informations.roi)]},CME.setBuildingInformations=function(a,b){this.informations.items[a]=b.items,this.informations.bonus[a]=b.bonus,this.informations.bci[a]=b.bci,this.informations.roi[a]=b.roi,this.informations.timeLeft[a]=b.timeLeft},CME.updateBuildingsInformations=function(){Game.ObjectsById.forEach(function(a,b){var c='(<span class="text-blue">'+a.amount+"</span>)";CME.setBuildingInformations(b,{items:a.name.split(" ")[0]+" "+c,bonus:a.getWorth(!0),bci:a.getBaseCostPerIncome(!0),roi:a.getReturnInvestment(),timeLeft:a.getTimeLeft()})})},CME.getBuildingWorth=function(a){return this.simulateBuy(a,"cookiesPs")},CME.getUpgradeWorth=function(a){return this.simulateBuy(a,"cookiesPs")},CME.getFrenzyMultiplier=function(){return Game.frenzy>0?Game.frenzyPower:1},CME.getLuckyTreshold=function(a,b){var c=b||Game.cookiesPs;return c/=this.getFrenzyMultiplier(),"frenzy"===a&&(c*=7),Math.round(10*(60*c*20+13))},CME.getHeavenlyMultiplier=function(){var a,b=2*Game.prestige["Heavenly chips"],c=0,d={"Heavenly chip secret":.05,"Heavenly cookie stand":.2,"Heavenly bakery":.25,"Heavenly confectionery":.25,"Heavenly key":.25};for(a in d)Game.Has(a)&&(c+=d[a]);return b*c},CME.cache=function(a,b,c){var d,e=[Game.UpgradesOwned,Game.BuildingsOwned,Game.globalCpsMult].join("-");return"undefined"==typeof this.cacheStore[e]&&(this.refreshCache(),this.cacheStore[e]={}),c=c||[],a=this.computeSalts(a,c),"undefined"!=typeof this.cacheStore[e][a]?this.cacheStore[e][a]:(d=b.apply(this,c),this.cacheStore[e][a]=d,d)},CME.callCached=function(a,b,c){return c=c||[],c.push(a),this.cache(c,this[a],b)},CME.refreshCache=function(){this.cacheStore={}},CME.computeSalts=function(a,b){a=a.concat(b);for(var c=0;c<a.length;c++)"undefined"!=typeof a[c].identifier&&(a[c]=a[c].identifier());return a.join("-")},CME.roundDecimal=function(a){return Math.round(100*a)/100},CME.secondsLeft=function(a){var b=Game.cookies-a.getPrice();return 0===Game.cookiesPs||b>0?0:Math.round(Math.abs(b)/CM.effectiveCps())},CME.getTimeToCookies=function(a){return CM.formatTime(a/CM.effectiveCps(),!0)},CMEO.identifier=function(){return"cookie-master__"+this.getType()+"--"+this.id},CMEO.matches=function(a){return this.desc?-1!==this.desc.toLowerCase().indexOf(a.toLowerCase()):!1},CMEO.getDescribedInteger=function(){return this.matches("<b>")?1*this.desc.match(/<b>\+?([\.0-9]+)%?/)[1].replace(/[%,]/g,""):void 0},CMEO.getTypeOf=function(){return this instanceof Game.Upgrade?"upgrade":"object"},CMEO.getWorthOf=function(a){var b="upgrade"===this.getType()?CME.callCached("getUpgradeWorth",[this]):CME.callCached("getBuildingWorth",[this]);return a?CME.roundDecimal(b):b},CMEO.getBaseCostPerIncome=function(a){var b,c=this.getWorth();return"upgrade"===this.getType()&&this.isClickingRelated()&&(c+=this.getClickingWorth()*CM.clickTracker.clicksPs),b=CME.roundDecimal(this.getPrice()/c),0>c?1/0:a?CME.roundDecimal(b):b},CMEO.getReturnInvestment=function(){var a=this.getWorth();return this.price*(a+Game.cookiesPs)/a},CMEO.getTimeLeft=function(){return CME.secondsLeft(this)},CMEO.getComparativeInfos=function(){return[this.getBaseCostPerIncome(),this.getTimeLeft(),this.getReturnInvestment()]},CMEO.getColors=function(){return CME.computeColorCoding(this.getComparativeInfos())},CME.getThresholdAlerts=function(a){var b=a.getPrice(),c=(Game.cookiesPs+a.getWorth(),CM.requiredChainTier("bank","this",CM.maxChainReward())),d=[0,0,0],e=[this.getLuckyTreshold(!1),this.getLuckyTreshold("frenzy"),c];return Game.cookies-b<e[0]&&(d[0]=e[0]-(Game.cookies-b)),Game.cookies-b<e[1]&&(d[1]=e[1]-(Game.cookies-b)),c!==!1&&Game.cookies-b<e[2]&&(d[2]=e[2]-(Game.cookies-b)),d},CME.computeColorCoding=function(a){var b,c=["yellow","yellow","yellow"],d=this.getBestValue("max"),e=this.getBestValue("min");for(b=0;b<a.length;b++)1/0===a[b]?c[b]="greyLight":a[b]<e[b]?c[b]="blue":a[b]===e[b]?c[b]="green":a[b]===d[b]?c[b]="red":a[b]>d[b]?c[b]="purple":d[b]-a[b]<a[b]-e[b]&&(c[b]="orange");return a[2]===e[2]&&(c[2]="cyan"),c},CMEO.isInStore=function(){return-1!==Game.UpgradesInStore.indexOf(this)},CME.simulateBuy=function(a,b){if("upgrade"===a.getType()&&a.bought>0)return 0;var c=[74,84,85,152,181,182,183,184,185,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229];if(-1!==c.indexOf(a.id))return 0;var d,e={SetResearch:Game.SetResearch,Popup:Game.Popup,Win:Game.Win,Unlock:Game.Unlock,Collect:Game.CollectWrinklers},f={seasonUses:Game.seasonUses,cpsSucked:Game.cpsSucked,globalCpsMult:Game.globalCpsMult,cookiesPs:Game.cookiesPs,computedMouseCps:Game.computedMouseCps,pledges:Game.pledges,elderWrath:Game.elderWrath};return Game.SetResearch=function(){},Game.Popup=function(){},Game.Win=function(){},Game.Unlock=function(){},Game.CollectWrinklers=function(){},a.simulateToggle(!0),Game.CalculateGains(),d=Game[b],a.simulateToggle(!1),Game.seasonUses=f.seasonUses,Game.cpsSucked=f.cpsSucked,Game.globalCpsMult=f.globalCpsMult,Game.cookiesPs=f.cookiesPs,Game.computedMouseCps=f.computedMouseCps,Game.pledges=f.pledges,Game.elderWrath=f.elderWrath,Game.SetResearch=e.SetResearch,Game.Popup=e.Popup,Game.Win=e.Win,Game.Unlock=e.Unlock,Game.CollectWrinklers=e.Collect,d-Game[b]},CMEO.simulateBuildingToggle=function(a){a?(this.amount++,this.bought++,this.buyFunction&&this.buyFunction()):(this.amount--,this.bought--,this.sellFunction&&this.sellFunction())},CMEO.simulateUpgradeToggle=function(a){a?(this.bought=1,this.buyFunction&&this.buyFunction(),3!==this.hide&&Game.UpgradesOwned++):(this.bought=0,3!==this.hide&&Game.UpgradesOwned--)},CMEO.isClickingRelated=function(){return this.matches("Clicking")||this.matches("The mouse")},CMEO.getClickingWorth=function(){return CME.callCached("getClickingUpgradeWorth",[this])},CME.getClickingUpgradeWorth=function(a){return this.simulateBuy(a,"computedMouseCps")},CME.controlTooltipPosition=function(){var a=Game.mouseY,b=CM.config.ccTooltip,c=CM.config.ccTooltipAnchor;this.tooltipLastObjectId&&(a=$(window).height()-b.outerHeight(),a-=40,a=-40>a?-40:a,a=Game.mouseY<a?Game.mouseY:a),c.offset({top:a,left:Game.mouseX})};var CM={};CM.config={version:"1.17.7",ccCompatibleVersions:["1.0453"],cmRefreshRate:1e3,cmFastRefreshRate:200,cmCheckUpdateRate:18e5,cmGCAudioAlertURL:"http://cookiemaster.creatale.de/assets/gc.mp3",cmSPAudioAlertURL:"http://cookiemaster.creatale.de/assets/sp.mp3",cmVersionURL:"http://cookiemaster.creatale.de/package.json",cmChangelogURL:"https://github.com/greenc/CookieMaster/blob/master/CHANGELOG.md",cmGCActualAlertURL:null,cmSPActualAlertURL:null,cmGCAudioObject:null,cmSPAudioObject:null,cmAudioGCNotified:!1,cmAudioSPNotified:!1,cmVisualGCNotified:!1,cmVisualSPNotified:!1,cmStatsLoggingReady:!1,cmStatsData:null,cmStatsChart:null,cmStatsLogStart:null,cmStatsLogTimer:null,cmVersionNotified:null,ccBody:$("body"),ccWrapper:$("#wrapper"),ccGame:$("#game"),ccSectionLeft:$("#sectionLeft"),ccSectionMiddle:$("#sectionMiddle"),ccSectionRight:$("#sectionRight"),ccComments:$("#comments"),ccGoldenCookie:$("#goldenCookie"),ccSeasonPopup:$("#seasonPopup"),ccTooltipAnchor:$("#tooltipAnchor"),ccTooltip:$("#tooltip"),cmMessageBar:null,cmTimerPanel:null,cmSettingsPanel:null,cmStatsPanel:null,cmStatsTable:null,cmOverlay:null,cmGCOverlay:null,cmNumFormatRanges:[{divider:1e24,suffix:{math:" Sp",si:" Y",standard:" septillion",longscale:" quadrillion",e:"e24",scientific:" &times; 10&sup2;&#8308;",compact:"*10&sup2;&#8308;"}},{divider:1e21,suffix:{math:" Sx",si:" Z",standard:" sextillion",longscale:" trilliard",e:"e21",scientific:" &times; 10&sup2;&sup1;",compact:"*10&sup2;&sup1;"}},{divider:1e18,suffix:{math:" Qi",si:" E",standard:" quintillion",longscale:" trillion",e:"e18",scientific:" &times; 10&sup1;&#8312;",compact:"*10&sup1;&#8312;"}},{divider:1e15,suffix:{math:" Qa",si:" P",standard:" quadrillion",longscale:" billiard",e:"e15",scientific:" &times; 10&sup1;&#8309;",compact:"*10&sup1;&#8309;"}},{divider:1e12,suffix:{math:" T",si:" T",standard:" trillion",longscale:" billion",e:"e12",scientific:" &times; 10&sup1;&sup2;",compact:"*10&sup1;&sup2;"}},{divider:1e9,suffix:{math:" B",si:" G",standard:" billion",longscale:" milliard",e:"e9",scientific:" &times; 10&#8313;",compact:"*10&#8313;"}},{divider:1e6,suffix:{math:" M",si:" M",standard:" million",longscale:" million",e:"e6",scientific:" &times; 10&#8310;",compact:"*10&#8310;"}}],cmTimerSettings:{gc:{label:"Next Cookie:"},sp:{label:"Next Reindeer:"},frenzy:{label:"Frenzy:",hide:["clot","elderFrenzy"]},elderFrenzy:{label:"Elder Frenzy:",hide:["clot","frenzy"]},clickFrenzy:{label:"Click Frenzy:"},clot:{label:"Clot:",hide:["frenzy","elderFrenzy"]},pledge:{label:"Pledge:"},wrinklers:{label:"Pop Wrinklers:"}},settingsGroups:{ui:{title:"Interface",desc:"These settings modify the game interface."},numbers:{title:"Numbers",desc:"These settings modify how numbers are displayed throughout the game."},alerts:{title:"Timers & Alerts",desc:"<strong>Notice:</strong>If you want to use custom audio alerts, please be mindful to link to non-copyrighted audio files on sites that explicitly allow hotlinking to avoid http://orteil.dashnet.org getting blacklisted!<br />Links to soundjay.com files are blocked as per the main game code."},helpers:{title:"Helpers",desc:"If you enjoy watching the game play itself, these settings are for you."},exp:{title:"Experimental",desc:"60% of the time, these work every time."}},settings:{cleanUI:{group:"ui",type:"checkbox",label:"Clean Interface:",desc:"Hide the top bar, and make other small graphical enhancements to the game interface.",current:"on"},timerBarPosition:{group:"ui",type:"select",label:"Timer Bar Position:",desc:"Position the custom timer bar at the top or bottom of the screen.",options:[{label:"Top",value:"top"},{label:"Bottom",value:"bottom"}],current:"bottom"},hideNativeTimers:{group:"ui",type:"checkbox",label:"Hide Native Timers:",desc:"Hide the native game timer bars.",current:"off"},showMissedGC:{group:"ui",type:"checkbox",label:"Show Missed Golden Cookies:",desc:"Whether or not to show the stat for missed Golden Cookies.",current:"on"},showAllUpgrades:{group:"ui",type:"checkbox",label:"Show All Upgrades:",desc:"Always display all available upgrades in the store (no need to hover).",current:"off"},hideBuildingInfo:{group:"ui",type:"checkbox",label:"Hide Building Info Boxes:",desc:"Hides the building information boxes that normally display when hovering each building section",current:"off"},colorBlind:{group:"ui",type:"checkbox",label:"Color Blind Mode:",desc:"Alternate color scheme that is color-blind friendly.",current:"off"},showEfficiencyKey:{group:"ui",type:"checkbox",label:"Show Efficiency Key:",desc:"Display building efficiency color key in the right panel.",current:"on"},showDeficitStats:{group:"ui",type:"checkbox",label:"Show Deficit Stats:",desc:"Show labels on item tooltips warning about Lucky and Chain deficits",current:"on"},changeFont:{group:"ui",type:"select",label:"Game Font:",desc:"Set the highlight font used throughout the game.",options:[{label:"Kavoon (default)",value:"default"},{label:"Serif",value:"serif"},{label:"Sans Serif",value:"sansserif"}],current:"default"},highVisibilityCookie:{group:"ui",type:"checkbox",label:"High Visibility Cookies:",desc:"Increase the contrast between Golden Cookies and the background.",current:"off"},increaseClickArea:{group:"ui",type:"checkbox",label:"Increase Cookie Hitbox:",desc:'Make the clickable area larger for Golden Cookies. Helps accuracy during chains. Requires "Show Timers" to be on.',current:"off"},numFormat:{group:"numbers",type:"select",label:"Number Formatting:",desc:"Sets the desired decimal and thousands separator symbols for numbers.",options:[{label:"1,234,567.890",value:"us"},{label:"1.234.567,890",value:"eu"}],current:"us"},shortNums:{group:"numbers",type:"checkbox",label:"Shorten Numbers:",desc:"Shorten large numbers with suffixes.",current:"on"},suffixFormat:{group:"numbers",type:"select",label:"Suffix Type:",desc:"Notation type to use for shortened number suffixes.",options:[{label:"Mathematical",value:"math"},{label:"SI Units",value:"si"},{label:"Standard (Short Scale)",value:"standard"},{label:"Long Scale",value:"longscale"},{label:"Scientific",value:"scientific"},{label:"Scientific (e-notation)",value:"e"},{label:"Scientific (compact)",value:"compact"}],current:"math"},precision:{group:"numbers",type:"select",label:"Precision:",desc:"How many decimal places to show for shortened numbers.",options:[{label:"0",value:"0"},{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"4",value:"4"}],current:"3"},showGCTimer:{group:"alerts",type:"checkbox",label:"Show Golden Cookie Timer:",desc:"Display countdown timer for next Golden Cookie.",current:"on"},showSPTimer:{group:"alerts",type:"checkbox",label:"Show Reindeer Timer:",desc:"Display countdown timer for next Reindeer.",current:"on"},showFrenzyTimer:{group:"alerts",type:"checkbox",label:"Show Frenzy Timer:",desc:"Display time remaining for Frenzy buff when active.",current:"on"},showElderFrenzyTimer:{group:"alerts",type:"checkbox",label:"Show Elder Frenzy Timer:",desc:"Display time remaining for Elder Frenzy buff when active.",current:"on"},showClickFrenzyTimer:{group:"alerts",type:"checkbox",label:"Show Click Frenzy Timer:",desc:"Display time remaining for Click Frenzy buff when active.",current:"on"},showClotTimer:{group:"alerts",type:"checkbox",label:"Show Clot Timer:",desc:"Display time remaining for Clot nerf when active.",current:"on"},showPledgeTimer:{group:"alerts",type:"checkbox",label:"Show Pledge Timer:",desc:"Display time remaining for Elder Pledge when active.",current:"on"},showGCCountdown:{group:"alerts",type:"checkbox",label:"Show Golden Cookie Countdown:",desc:"Display a countdown timer on Golden Cookies showing how long you have left to click them",current:"on"},visualAlerts:{group:"alerts",type:"select",label:"Visual Alerts:",desc:"Flash the screen when Golden Cookies and Reindeer spawn.",options:[{label:"Off",value:"off"},{label:"Golden Cookie",value:"gc"},{label:"Reindeer",value:"sp"},{label:"All",value:"all"}],current:"all"},audioAlerts:{group:"alerts",type:"select",label:"Audio Alerts:",desc:"Play an audio alert when Golden Cookies and Reindeer spawn.",options:[{label:"Off",value:"off"},{label:"Golden Cookie",value:"gc"},{label:"Reindeer",value:"sp"},{label:"All",value:"all"}],current:"all"},audioVolume:{group:"alerts",type:"range",label:"Audio Alert Volume:",desc:"Adjust the playback volume of the audio alerts.",options:{min:0,max:1,step:.1},current:.4},customGCAlert:{group:"alerts",type:"text",label:"Custom Golden Cookie Alert URL:",desc:"Specify your own audio alert for Golden Cookie notifications. URL should link to an MP3 file with a max play time of 2 seconds.",placeholder:"http://example.com/file.mp3",current:""},customSPAlert:{group:"alerts",type:"text",label:"Custom Reindeer Alert URL:",desc:"Specify your own audio alert for Reindeer notifications. URL should link to an MP3 file with a max play time of 2 seconds.",placeholder:"http://example.com/file.mp3",current:""},autoPledge:{group:"helpers",type:"checkbox",label:"Auto-Pledge:",desc:"Automatically rebuy Elder Pledge upgrade to keep the Grandmapocalypse at bay.",current:"off"},clickSanta:{group:"helpers",type:"checkbox",label:"Auto-buy Santa Unlocks:",desc:"Automatically buy the Santa unlocks when they become available.",current:"off"},popWrinklersAtInterval:{group:"helpers",type:"select",label:"Automatically Pop Wrinklers:",desc:"Set a timer to automatically pop all Wrinklers at the specified interval.",options:[{label:"Off",value:"off"},{label:"Every 10 minutes",value:6e5},{label:"Every 30 minutes",value:18e5},{label:"Every hour",value:36e5},{label:"Every 4 hours",value:144e5},{label:"Every 8 hours",value:288e5}],current:"off"},trueNeverclick:{group:"helpers",type:"checkbox",label:"True Neverclick Helper:",desc:"Prevents clicks on the Big Cookie until you unlock the True Neverclick achievement. Make sure to disable auto-click if using this feature.",current:"off"},autoClickPopups:{group:"helpers",type:"select",label:"Auto-click Popups:",desc:"Automatically click Golden Cookies and Reindeer when they spawn.",options:[{label:"Off",value:"off"},{label:"Golden Cookies",value:"gc"},{label:"Reindeer",value:"sp"},{label:"All",value:"all"}],current:"off"},autoClick:{group:"helpers",type:"select",label:"Auto-click Big Cookie:",desc:"Automatically click the big cookie. WARNING: High values may cause lag (and a guilty conscience).",options:[{label:"Off",value:"off"},{label:"Click Frenzies & Elder Frenzies",value:"clickFrenzies"},{label:"All Frenzies",value:"allFrenzies"},{label:"All the time",value:"on"}],current:"off"},autoClickSpeed:{group:"helpers",type:"range",label:"Auto-click Speed:",desc:"How many times per second to auto-click the big cookie. Note that most browsers throttle timers to 1 second intervals when the page is running in the background.",options:{min:1,max:250,step:1},current:10},autoBuy:{group:"exp",type:"checkbox",label:"Auto-buy:",desc:"Automatically buy the most efficient buildings and upgrades",current:"off"},maintainBank:{group:"exp",type:"checkbox",label:"Maintain Bank:",desc:"If enabled, the auto-buyer will respect the Lucky+Frenzy bank requirements after Get Lucky has been purchased.",current:"off"},noPocalypse:{group:"exp",type:"checkbox",label:"No-pocalypse:",desc:"Do not let auto-buy purchase further research upgrades past Underworld ovens",current:"off"},enableLogging:{group:"exp",type:"checkbox",label:"Enable Logging:",desc:"Enables the ability to log stats and view a log chart. Logging can be managed in the Stats panel when this setting is active.",current:"off"},trueCpsAverage:{group:"exp",type:"range",label:"True CpS Tracking Duration:",desc:"CookieMaster tracks your true CpS on a rolling basis in order to improve efficiency algorithms. This setting allows you to adjust the rolling period in minutes. If you are building very quickly (e.g. have many HCs), you should set this to a lower value.",options:{min:5,max:240,step:1},current:60},clickingAverage:{group:"exp",type:"range",label:"Click Tracking Duration:",desc:"CookieMaster tracks your Big Cookie clicks on a rolling basis in order to improve efficiency algorithms. This setting allows you to adjust the rolling period in minutes.",options:{min:5,max:240,step:1},current:60}}},CM.timers={},CM.trueCps={},CM.clickTracker={},CM.init=function(){var a=this,b=this.config.cmRefreshRate,c=this.config.cmFastRefreshRate,d=this.config.cmCheckUpdateRate,e=Game.version.toString();this.config.cmMessageBar=$('<div id="CMMessageBar"><span id="CMMessageBarDismissAll">Dismiss all</span></div>'),this.config.ccBody.append(this.config.cmMessageBar),this.loadUserSettings(),this.attachSettingsPanel(),this.attachStatsPanel(),this.attachTimerPanel(),this.AddPopWrinklersButton(),this.setupTooltips(),this.setupDynamicTooltips(),this.setEvents(),this.attachAutoBuyPanel(),this.autoBuyer=new this.AutoBuy,this.applyUserSettings(),Game.tooltip.draw=this.appendToNative(Game.tooltip.draw,CM.updateTooltips),Game.RefreshStore=this.appendToNative(Game.RefreshStore,CM.updateTooltips),setInterval(function(){a.mainLoop()},b),setInterval(function(){a.updateTitleTicker(),"off"!==a.config.settings.audioAlerts.current&&a.playAudioAlerts(),"off"!==a.config.settings.autoClickPopups.current&&a.autoClickPopups()},c),setInterval(function(){a.checkForUpdate()},d),-1===this.compatibilityCheck(e)&&this.message("<strong>Warning:</strong> CookieMaster has not been tested on this version of Cookie Clicker. Continue at your own peril!","warning"),0===Game.seasonPopup.maxTime&&0===Game.goldenCookie.maxTime&&this.fixNewGameSpawns(),this.popup("CookieMaster v."+this.config.version+" loaded successfully!","notice")},CM.compatibilityCheck=function(a){var b,c=this.config.ccCompatibleVersions;for(b=0;b<c.length;b++)if(c[b].match(a))return b;return-1},CM.largeNumFormat=function(a,b){var c,d,e="on"===this.config.settings.shortNums.current?!0:!1,f=this.config.settings.suffixFormat.current,g=this.config.settings.precision.current,h="us"===this.config.settings.numFormat.current?".":",",i=this.config.cmNumFormatRanges,j="."===h?".":",",k="."===h?",":".",l=b||0,m=0>a?"-":"";if(!isFinite(a))return"Infinity";if(a=Math.abs(a),e)for(d=0;d<i.length;d++)if(a>=i[d].divider)return a=Math.floor(a/i[d].divider*Math.pow(10,g))/Math.pow(10,g),a=a.toFixed(g)+i[d].suffix[f],m+a.replace(".",j);return a=Math.round(a*Math.pow(10,l))/Math.pow(10,l),c=a.toString().split("."),c[0]=c[0].replace(/\B(?=(\d{3})+(?!\d))/g,k),m+c.join(j)},CM.Timer=function(a,b){this.type=a,this.label=b,this.id="CMTimer-"+this.type,this.container={},this.barOuter={},this.barInner={},this.counter={},this.limiter=null,this.create=function(){var a,b=this.getTimings(),c=$("<div />").attr({"class":"cmTimerContainer cf cmTimer-"+this.type,id:this.id}),d=$("<div />").addClass("cmTimer"),e=$("<div />"),f=$("<div />").addClass("cmTimerLabel").text(this.label),g=$("<div />").addClass("cmTimerCounter").text(Math.round(b.minCurrent)),h=null,i=b.minCurrent/b.max*100;return b.hasOwnProperty("min")&&b.min>0&&(a=b.min/b.max*100,100-a>i&&c.addClass("cmEmphasize"),h=$("<span />").css("width",a+"%"),d.append(h)),e.css("width",i+"%"),d.append(e),c.append(f,d,g),this.container=c,this.barOuter=d,this.barInner=e,this.counter=g,this.limiter=h,c},this.update=function(){var a,b=this.limiter,c=this.barOuter,d=this.getTimings(),e=d.minCurrent/d.max*100;return d.hasOwnProperty("min")&&d.min&&(this.limiter||(b=$("<span />"),c.append(b),this.limiter=b),a=d.min/d.max*100,this.limiter.css("width",a+"%"),100-a>e?(this.limiter.fadeOut(500),this.container.addClass("cmEmphasize")):(this.limiter.show(),this.container.removeClass("cmEmphasize"))),this.barInner.css("width",e+"%"),this.counter.text(Math.round(d.minCurrent)),this},this.getTimings=function(){var a={},b=Game.Has("Get lucky"),c=Game.Has("Sacrificial rolling pins")?60:30,d=CM.popWrinklersTimeRelative,e=(new Date).getTime();return"sp"===this.type?(a.min=Game.seasonPopup.minTime/Game.fps,a.minCurrent=(Game.seasonPopup.maxTime-Game.seasonPopup.time)/Game.fps,a.max=Game.seasonPopup.maxTime/Game.fps):"gc"===this.type?(a.min=Game.goldenCookie.minTime/Game.fps,a.minCurrent=(Game.goldenCookie.maxTime-Game.goldenCookie.time)/Game.fps,a.max=Game.goldenCookie.maxTime/Game.fps):"frenzy"===this.type?(a.minCurrent=Game.frenzy/Game.fps,a.max=77+77*b):"clickFrenzy"===this.type?(a.minCurrent=Game.clickFrenzy/Game.fps,a.max=13+13*b):"elderFrenzy"===this.type?(a.minCurrent=Game.frenzy/Game.fps,a.max=6+6*b):"clot"===this.type?(a.minCurrent=Game.frenzy/Game.fps,a.max=66+66*b):"pledge"===this.type?(a.minCurrent=Game.pledgeT/Game.fps,a.max=60*c):"wrinklers"===this.type&&(a.minCurrent=(CM.popWrinklersTime-e)/1e3,a.max=d/1e3),a},this.show=function(){if(this.container.is(":hidden")){var a=this.container.children();a.css("opacity",0),this.container.slideDown(200,function(){a.animate({opacity:1},200)})}return this},this.hide=function(){if(this.container.is(":visible")){var a=this.container;this.container.children().animate({opacity:0},200,function(){a.slideUp(200)})}return this}},CM.cookiesToHeavenly=function(a){return Math.floor(Math.sqrt(25e10+2*a)/1e6-.5)},CM.heavenlyToCookies=function(a){return 5e11*a*(a+1)},CM.heavenlyToCookiesRemaining=function(a){var b=this.heavenlyToCookies(a)-(Game.cookiesReset+Game.cookiesEarned);return b>0?b:0},CM.getHCStats=function(){var a=[],b=Game.prestige["Heavenly chips"],c=2*b,d=this.cookiesToHeavenly(Game.cookiesReset+Game.cookiesEarned),e=2*d,f=this.heavenlyToCookiesRemaining(d+1),g=this.heavenlyToCookies(d+1)-this.heavenlyToCookies(d),h=Math.round(f/this.effectiveCps());return a=[b,c,d,e,f,g,this.formatTime(h)]},CM.testResetFormula=function(a){var b=Game.cookiesEarned/1e12,c=(new Date).getTime(),d=(c-Game.startDate)/1e3,e=CM.baseCps()/1e12,f=this.cookiesToHeavenly(Game.cookiesReset+Game.cookiesEarned),g=f-Game.prestige["Heavenly chips"],h=a||1,i=h*e*d-b,j=Math.pow(g,2)/2;console.log("X: ",Beautify(i)),console.log("Y: ",Beautify(j))},CM.getBaseMultiplier=function(a,b){var c,d,e=a||parseFloat(Game.prestige["Heavenly chips"]),f=1,g=0,h=Game.Has("Santa's milk and cookies")?1.05:1;for(d in Game.Upgrades)c=Game.Upgrades[d],c.bought>0&&"cookie"===c.type&&Game.Has(c.name)&&(f+=.01*c.power);return f+=.01*Game.Has("Specialized chocolate chips"),f+=.02*Game.Has("Designer cocoa beans"),f+=.03*Game.Has("Underworld ovens"),f+=.04*Game.Has("Exotic nuts"),f+=.05*Game.Has("Arcane sugar"),f+=.15*Game.Has("Increased merriness"),f+=.15*Game.Has("Improved jolliness"),f+=.01*Game.Has("A lump of coal"),f+=.01*Game.Has("An itchy sweater"),f+=.5*Game.Has("Santa's dominion"),Game.Has("Santa's legacy")&&(f+=.1*(Game.santaLevel+1)),b?g=1:(g+=.05*Game.Has("Heavenly chip secret"),g+=.2*Game.Has("Heavenly cookie stand"),g+=.25*Game.Has("Heavenly bakery"),g+=.25*Game.Has("Heavenly confectionery"),g+=.25*Game.Has("Heavenly key")),f+=.02*e*g,Game.Has("Kitten helpers")&&(f*=1+.05*Game.milkProgress*h),Game.Has("Kitten workers")&&(f*=1+.1*Game.milkProgress*h),Game.Has("Kitten engineers")&&(f*=1+.2*Game.milkProgress*h),Game.Has("Kitten overseers")&&(f*=1+.2*Game.milkProgress*h),Game.Has("Kitten managers")&&(f*=1+.2*Game.milkProgress*h),Game.Has("Elder Covenant")&&(f*=.95),f},CM.getResetCps=function(){var a=this.cookiesToHeavenly(Game.cookiesReset+Game.cookiesEarned),b=this.getBaseMultiplier(a,!0),c=Game.cookiesPs/Game.globalCpsMult;return c*b},CM.baseCps=function(){var a=Game.frenzy>0?Game.frenzyPower:1;return Game.cookiesPs/a},CM.effectiveCps=function(){return this.trueCps.cps>0?this.trueCps.cps:Game.cookiesPs},CM.baseCpc=function(){var a=Game.frenzy>0?Game.frenzyPower:1,b=Game.clickFrenzy>0?777:1;return Game.mouseCps()/a/b},CM.luckyBank=function(){return 1200*this.baseCps()*10+13},CM.luckyFrenzyBank=function(){return 1200*this.baseCps()*10*7+13},CM.maxLuckyReward=function(){return 1200*this.baseCps()+13},CM.maxLuckyFrenzyReward=function(){return 1200*this.baseCps()*7+13},CM.luckyReward=function(){return Math.min(Game.cookies/10+13,1200*this.baseCps()+13)},CM.luckyFrenzyReward=function(){return Math.min(Game.cookies/10+13,1200*this.baseCps()*7+13)},CM.maxChainReward=function(){var a=Game.cookies/4,b=60*Game.cookiesPs*60*6,c=3===Game.elderWrath?!0:!1,d=c?66666:77777;if(Game.cookiesEarned<1e5)return!1;for(;a>d&&b>=d&&7777777777777778e5>d;)d+=c?"6":"7",d=parseInt(d,10);return d.toString().slice(0,-1)},CM.requiredChainTier=function(a,b,c){var d,e=3===Game.elderWrath?!0:!1,f=e?"6":"7",g=e?66666:77777,h=e?666666:777777,i=g>c?g:parseInt(c,10),j=g>c?h:parseInt(c+f,10);return Game.cookiesEarned<1e5?!1:(d="this"===b?i:j,"bank"===a?4*d:d/6/60/60)},CM.getWrinklerStats=function(){var a=0,b=1.1;return $.each(Game.wrinklers,function(){a+=this.sucked}),[a,a*b]},CM.getReindeerReward=function(){var a=Game.Has("Ho ho ho-flavored frosting")?2:1;return Math.max(25,60*Game.cookiesPs)*a},CM.fixNewGameSpawns=function(){Game.goldenCookie.minTime=Game.goldenCookie.getMinTime(),Game.goldenCookie.maxTime=Game.goldenCookie.getMaxTime(),Game.seasonPopup.minTime=Game.seasonPopup.getMinTime(),Game.seasonPopup.maxTime=Game.seasonPopup.getMaxTime(),Game.goldenCookie.toDie=0,Game.seasonPopup.toDie=0},CM.formatTime=function(a,b){var c,d=Math.round(a),e=parseInt(d/86400)%999,f=parseInt(d/3600)%24,g=parseInt(d/60)%60,h=d%60,i=[" days, "," hours, "," minutes, "," seconds"];return"undefined"==typeof b&&(b=!1),isFinite(d)?d/86400>1e3?"> 1,000 days":(b?i=["d, ","h, ","m, ","s"]:(1===e&&(i[0]=" day, "),1===f&&(i[1]=" hour, "),1===g&&(i[2]=" minute, "),1===h&&(i[3]=" second")),c="",e>0&&(c+=e+i[0]),(e>0||f>0)&&(c+=f+i[1]),(e>0||f>0||g>0)&&(c+=g+i[2]),(e>0||f>0||g>0||h>0)&&(c+=h+i[3]),c):"Never"},CM.wrinklersExist=function(){var a;for(a=0;a<Game.wrinklers.length;a++)if(Game.wrinklers[a].phase>0)return!0;return!1},CM.getMissingUpgrades=function(){var a,b=[],c=Game.Has("Season switcher");for(a in Game.Upgrades)1!==Game.Upgrades[a].debug&&0===Game.Upgrades[a].unlocked&&(c?"Ghostly biscuit"!==Game.Upgrades[a].name&&"Lovesick biscuit"!==Game.Upgrades[a].name&&"Festive biscuit"!==Game.Upgrades[a].name&&b.push(a):b.push(a));return b},CM.getMissingAchievements=function(a){var b,c=[];for(b in Game.Achievements)"none"===Game.Achievements[b].category&&0===Game.Achievements[b].won&&(a?3===Game.Achievements[b].hide&&c.push(b):3!==Game.Achievements[b].hide&&c.push(b));return c},CM.toTitleCase=function(a){return a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})},CM.popup=function(a,b){var c=this.toTitleCase(b)||"Notice";return Game.Popup('<span class="cmPopupText cmPopup'+c+'">'+a+"</span>")},CM.appendToNative=function(a,b){return function(){a.apply(this,arguments),b.apply(CM)}},CM.replaceCode=function(a,b){var c;a=a.toString();for(c in b)a=a.replace(c,b[c]);return a.replace(/^function[^{]+{/i,"").replace(/}[^}]*$/i,"")},CM.replaceNative=function(a,b,c){var d=Game[a];"undefined"==typeof c&&(c=""),Game[a]=new Function(c,this.replaceCode(d,b))},CM.versionCompare=function(a,b,c){function d(a){return(f?/^\d+[A-Za-z]*$/:/^\d+$/).test(a)}var e,f=c&&c.lexicographical,g=c&&c.zeroExtend,h=a.split("."),i=b.split(".");if(!h.every(d)||!i.every(d))return 0/0;if(g){for(;h.length<i.length;)h.push("0");for(;i.length<h.length;)i.push("0")}for(f||(h=h.map(Number),i=i.map(Number)),e=0;e<h.length;++e){if(i.length===e)return 1;if(h[e]!==i[e])return h[e]>i[e]?1:-1}return h.length!==i.length?-1:0},CM.testAudioObject=function(a){return 1===a.networkState?!0:!1},CM.AutoBuy=function(){return this.gcUpgrades=[52,53,86],this.elderCovenant=[74,84,85],this.alwaysBuy=[87,141,152,157,158,159,160,161,163,164,168],this.grandmapocalypse=[69,70,71,72,73],this.seasonal=[181,182,183,184,185],this.automate=null,this.threshold="none",this.nextMaxTime=0,this.blackList=function(){var a=[];return a.push.apply(a,this.seasonal),a.push.apply(a,this.elderCovenant),"on"===CM.config.settings.noPocalypse.current&&a.push.apply(a,this.grandmapocalypse),a},this.whiteList=function(){var a=[];return a.push.apply(a,this.gcUpgrades),a.push.apply(a,this.alwaysBuy),a},this.getCheapest=function(a){var b,c,d,e=Number.POSITIVE_INFINITY;return a.forEach(function(a){c=Game.UpgradesById[a],c.isInStore()&&(d=Game.UpgradesById[a].getPrice(),e>d&&(e=d,b=c))}),b?[b,e]:!1},this.setThreshold=function(){var a="on"===CM.config.settings.maintainBank.current;this.threshold=Game.Has("Get lucky")&&a?"frenzy":"none"},this.getBestBuilding=function(){var a,b,c=CME.informations.bci,d=Number.POSITIVE_INFINITY,e=!1,f=!1;
for(b=0;b<c.length;b++)a=Game.ObjectsById[b],f=a.getPrice()<=Game.cookiesEarned?!0:!1,c[b]<d&&f&&(d=c[b],e=a);return[e,d]},this.getBestUpgrade=function(){var a,b,c,d=this.blackList(),e=this.whiteList(),f=this.getCheapest(e),g=Number.POSITIVE_INFINITY,h=!1;for(c in Game.Upgrades)b=Game.Upgrades[c],-1===d.indexOf(b.id)&&b.isInStore()&&(a=b.getBaseCostPerIncome(),g>a&&(h=b,g=a));return f&&h&&f[1]<h.getPrice()?[f[0],0]:h!==!1?[h,g]:!1},this.getBestItem=function(){var a=this.getBestBuilding(),b=this.getBestUpgrade();return a&&b?b[1]<a[1]?b[0]:a[0]:a[0]||b[0]||!1},this.budget=function(a,b){var c=0;return"frenzy"===b?c=CME.getLuckyTreshold("frenzy"):"lucky"===b&&(c=CME.getLuckyTreshold(!1)),a-c},this.buyBest=function(){this.setThreshold();var a,b,c,d,e=this,f=this.getBestItem(),g=this.budget(Game.cookies,this.threshold),h=!1;f?(a=f.getTimeLeft(),b=f.getPrice(),h=g>=b?!0:!1,h?(this.nextMaxTime=0,f.buy(!0),d=50):(this.nextMaxTime=0===this.nextMaxTime?a:this.nextMaxTime,c=Math.min(a/this.nextMaxTime*100,100),d=200),$("#CMAutoBuyNextPurchaseValue").text(f.name),$("#CMAutoBuyTimeLeft .cmTimer div").css("width",c+"%"),$("#CMAutoBuyTimeLeft .cmTimerCounter").text(a),$("#CMAutoBuyTimeLeft .cmTimerContainer").is(":hidden")&&$("#CMAutoBuyTimeLeft .cmTimerContainer").fadeIn(300)):($("#CMAutoBuyNextPurchaseValue").text("Nothing to buy :("),$("#CMAutoBuyTimeLeft .cmTimerContainer").fadeOut(300),d=1e3),this.automate=setTimeout(function(){e.buyBest()},d)},this.init=function(){this.buyBest()},this.stop=function(){clearTimeout(this.automate)},this},CM.TrueCps=function(a,b){return this.ready=!1,this.last=Game.cookiesEarned,this.tracked=[],this.interval=a||60,this.maxTime=b||3600,this.timer=null,this.cps=0,this.getAverage=function(a){var b,c,d=a||this.tracked,e=d.length,f=0;if(0===e)return 0;for(c=0;e>c;c++)f+=parseInt(d[c],10);return b=f/e/this.interval,this.cps=b,b},this.takeRecord=function(a,b){var c=b-a,d=Math.round(this.maxTime/this.interval);return this.tracked.length===d&&this.tracked.shift(),this.tracked.push(c),this.last=b,this.getAverage(),this.ready=!0,this},this.timeTracked=function(){return this.tracked.length*this.interval},this.start=function(){var a=this;return this.stop(),this.last=Game.cookiesEarned,this.tracked=[],this.timer=setInterval(function(){a.takeRecord(a.last,Game.cookiesEarned)},1e3*a.interval),this},this.stop=function(){return clearInterval(this.timer),this},this},CM.ClickTracker=function(a,b){return this.ready=!1,this.last=Game.cookieClicks,this.tracked=[],this.interval=a||60,this.maxTime=b||3600,this.timer=null,this.clicksPs=0,this.getAverage=function(a){var b,c,d=a||this.tracked,e=d.length,f=0;if(0===e)return 0;for(c=0;e>c;c++)f+=parseInt(d[c],10);return b=f/e/this.interval,this.clicksPs=b,b},this.takeRecord=function(a,b){var c=b-a,d=Math.round(this.maxTime/this.interval);return this.tracked.length===d&&this.tracked.shift(),this.tracked.push(c),this.last=b,this.getAverage(),this.ready=!0,this},this.timeTracked=function(){return this.tracked.length*this.interval},this.start=function(){var a=this;return this.stop(),this.last=Game.cookieClicks,this.tracked=[],this.timer=setInterval(function(){a.takeRecord(a.last,Game.cookieClicks)},1e3*a.interval),this},this.stop=function(){return clearInterval(this.timer),this},this},CM.mainLoop=function(){var a=this.config.settings;this.updateTimers(),"on"===a.showGCCountdown.current&&this.updateDisplayGCTimer(),"off"!==a.visualAlerts.current&&this.showVisualAlerts(),this.manageAutoClicker(),this.config.cmStatsPanel.is(":visible")&&this.updateStats(),"on"===a.autoPledge.current&&this.autoBuyPledge(),"on"===a.clickSanta.current&&Game.Has("A festive hat")&&Game.santaLevel<14&&this.clickSanta(),CME.updateBuildingsInformations(),this.updateTooltips()},CM.attachSettingsPanel=function(){var a,b,c,d,e,f=[],g=[],h="",i="",j="",k="",l=this.config.settingsGroups,m=this.config.settings,n=this.config.ccSectionMiddle,o=this.config.ccComments,p=$("<div />").attr("id","CMSettingsPanel"),q=$("<div />").attr({id:"CMSettingsPanelButton","class":"button"}).text("Settings"),r=$("<h3 />").attr("class","title").html("CookieMaster Settings"),s=$("<ul />").attr({id:"CMSettingsTabs","class":"cf cmFont"}),t=$("<div />").attr("id","CMSettingsTables"),u=$("<button />").attr({id:"CMSettingsSave",type:"button","class":"cmFont"}).text("Save Settings");for(a in l){k+='<li><a data-id="CMSettings-'+a+'">'+l[a].title+"</a></li>",j+='<div id="CMSettings-'+a+'" class="cmTableGroup">',j+='<table class="cmTable">',l[a].desc&&(j+='<tr class="cmDesc">',j+='<td colspan="2"><p class="cmNotice">'+l[a].desc+"</p></td>",j+="</tr>");for(b in m)if(c=m[b],c.group===a){if(f="",e={},h=c.current,"select"===c.type){for(e in c.options)d=c.options[e],i=h===d.value.toString()?' selected="selected"':"",f+='<option value="'+d.value+'"'+i+">"+d.label+"</option>";g='<select name="'+b+'">',g+=f,g+="</select>"}else"checkbox"===c.type?(i="on"===h?' checked="checked"':"",g='<input type="checkbox" name="'+b+'"'+i+" />"):"range"===c.type?(g='<span class="currentValue">'+c.current+"</span>",g+='<input type="range" name="'+b+'" value="'+c.current+'" min="'+c.options.min+'" max="'+c.options.max+'" step="'+c.options.step+'" />'):"text"===c.type&&(g='<input type="text" name="'+b+'" value="'+c.current+'" placeholder="'+c.placeholder+'" />');j+='<tr class="setting setting-'+b+'">',j+='<td class="cmLabel">',j+='<label for="CMSetting-'+b+'">'+c.label+"</label>",j+="<small>"+c.desc+"</small>",j+="</td>",j+='<td class="cmValue">'+g+"</td>",j+="</tr>"}j+="</table>",j+="</div>"}s.append(k),t.append(j),p.append(u,r,s,t),n.append(p),o.prepend(q),this.config.cmSettingsPanel=p,$("#CMSettings-ui").addClass("show"),$("#CMSettingsTabs li:first-child a").addClass("active"),$("#CMSettingsTabs a").click(function(){var a=$(this).data("id");$(".cmTableGroup").removeClass("show"),$("#"+a).addClass("show"),$("#CMSettingsTabs a").removeClass("active"),$(this).addClass("active")})},CM.attachStatsPanel=function(){var a=this.config.ccSectionMiddle,b=this.config.ccComments,c=$("<div />").attr("id","CMStatsPanel"),d=$("<h3 />").attr("class","title").html('CookieMaster Statistics<span class="cmTitleSub">v.'+this.config.version+"</span>"),e=$("<div />").attr({id:"CMStatsPanelButton","class":"button"}).text("Stats +"),f={},g=$("<h3 />").attr("class","cmFont cmSubTitle").html('Missing Upgrades<span class="cmFloatRight cmShowAsLink" id="CMToggleUpg">Show/Hide</span>'),h=$("<h3 />").attr("class","cmFont cmSubTitle").html('Missing Achievements<span class="cmFloatRight cmShowAsLink" id="CMToggleAch">Show/Hide</span>'),i=$("<h3 />").attr("class","cmFont cmSubTitle").html('Missing Shadow Achievements<span class="cmFloatRight cmShowAsLink" id="CMToggleSha">Show/Hide</span>'),j=$("<div />").attr("id","CMUpgCont"),k=$("<div />").attr("id","CMAchCont"),l=$("<div />").attr("id","CMShaCont"),m=$("<div />").attr("id","CMChartCont"),n=$("<h3 />").attr("class","title").html("Stat Logging"),o=$("<p />").html("This feature currently allows you to log and track your base and effective CpS stats over time. Stats are logged at 30 second intervals as long as logging is on, and logs are persistent though page refreshes, game resets and save imports unless cleared manually.<br />Please note that this feature is still in beta, and may behave unexpectedly!<br />Download as CSV is currently only supported in recent versions of Chrome and Firefox."),p=$("<div />").attr("id","CMChart"),q=$("<button />").attr({id:"CMChartY",type:"button","class":"cmFont"}).text("Start logging"),r=$("<button />").attr({id:"CMChartN",type:"button","class":"cmFont"}).text("Stop logging"),s=$("<button />").attr({id:"CMChartC",type:"button","class":"cmFont"}).text("Clear log"),t=$("<button />").attr({id:"CMChartD",type:"button","class":"cmFont"}).text("Download CSV"),u='<input id="CMXHC" value="" />',v="";v+='<table class="cmTable">',v+='<tr class="cmHeader">',v+='<th colspan="2" class="cmFont"><span class="icon cmIcon cmIconLucky"></span>Golden Cookies</th>',v+="</tr>",v+="<tr>",v+="<td>Lucky bank required:</td>",v+='<td class="cmValue" id="CMStatsLuckyRequired"></td>',v+="</tr>",v+="<tr>",v+="<td>Lucky + Frenzy bank required:</td>",v+='<td class="cmValue" id="CMStatsLuckyFrenzyRequired"></td>',v+="</tr>",v+="<tr>",v+="<td>Lucky reward:</td>",v+='<td class="cmValue" id="CMStatsLuckyReward"></td>',v+="</tr>",v+="<tr>",v+="<td>Lucky + Frenzy reward:</td>",v+='<td class="cmValue" id="CMStatsLuckyFrenzyReward"></td>',v+="</tr>",v+="<tr>",v+="<td>Reindeer Reward:</td>",v+='<td class="cmValue" id="CMStatsReindeerReward"></td>',v+="</tr>",v+="<tr>",v+="<td>Maximum Cookie Chain reward:</td>",v+='<td class="cmValue" id="CMStatsMaxChainReward"></td>',v+="</tr>",v+="<tr>",v+="<td>Bank required for next Chain tier:</td>",v+='<td class="cmValue" id="CMStatsBankRequiredNextChainTier"></td>',v+="</tr>",v+="<tr>",v+="<td>CpS required for next Chain tier:</td>",v+='<td class="cmValue" id="CMStatsCPSRequiredNextChainTier"></td>',v+="</tr>",v+="<tr>",v+="<td>Last Golden Cookie effect:</td>",v+='<td class="cmValue" id="CMStatsLastGC"></td>',v+="</tr>",v+="<tr>",v+="<td>Average clicks per second:</td>",v+='<td class="cmValue" id="CMStatsAvgClicksPerSecond"></td>',v+="</tr>",v+="<tr>",v+="<td>Golden Cookies Missed:</td>",v+='<td class="cmValue" id="CMStatsMissedGC"></td>',v+="</tr>",v+="</table>",v+='<table class="cmTable">',v+='<tr class="cmHeader">',v+='<th colspan="2" class="cmFont"><span class="icon cmIcon cmIconHC"></span>Prestige</th>',v+="</tr>",v+="<tr>",v+="<td>Current Heavenly Chips:</td>",v+='<td class="cmValue" id="CMStatsHCCurrent"></td>',v+="</tr>",v+="<tr>",v+="<td>Heavenly Chips after reset:</td>",v+='<td class="cmValue" id="CMStatsHCMax"></td>',v+="</tr>",v+="<tr>",v+="<td>Base CpS after reset*:</td>",v+='<td class="cmValue" id="CMStatsCPSReset"></td>',v+="</tr>",v+="<tr>",v+="<td>Cookies to next HC:</td>",v+='<td class="cmValue" id="CMStatsHCCookiesToNext"></td>',v+="</tr>",v+="<tr>",v+="<td>Time to next HC:</td>",v+='<td class="cmValue" id="CMStatsHCTimeToNext"></td>',v+="</tr>",v+="<tr>",v+="<td>Cookies to "+u+" Heavenly Chips:</td>",v+='<td class="cmValue" id="CMStatsHCCookiesToX"></td>',v+="</tr>",v+="<tr>",v+='<td colspan="2"><small>* Based on current purchases. Assumes all Heavenly Upgrades bought.</small></td>',v+="</tr>",v+="</table>",v+='<table class="cmTable">',v+='<tr class="cmHeader">',v+='<th colspan="2" class="cmFont"><span class="icon cmIcon cmIconWrinkler"></span>Wrinklers</th>',v+="</tr>",v+="<tr>",v+="<td>Cookies sucked by Wrinklers:</td>",v+='<td class="cmValue" id="CMStatsWrinklersSucked"></td>',v+="</tr>",v+="<tr>",v+="<td>Reward for popping Wrinklers:</td>",v+='<td class="cmValue" id="CMStatsWrinklersReward"></td>',v+="</tr>",v+="</table>",v+='<table class="cmTable">',v+='<tr class="cmHeader">',v+='<th colspan="2" class="cmFont"><span class="icon cmIcon cmIconMisc"></span>Miscellaneous Stats</th>',v+="</tr>",v+="<tr>",v+="<td>Base CpS:</td>",v+='<td class="cmValue" id="CMStatsBaseCPS"></td>',v+="</tr>",v+="<tr>",v+="<td>Effective CpS:</td>",v+='<td class="cmValue" id="CMStatsEffectiveCPS"></td>',v+="</tr>",v+="<tr>",v+="<td>Frenzy CpS:</td>",v+='<td class="cmValue" id="CMStatsFrenzyCPS"></td>',v+="</tr>",v+="<tr>",v+="<td>Elder Frenzy CpS:</td>",v+='<td class="cmValue" id="CMStatsElderFrenzyCPS"></td>',v+="</tr>",v+="<tr>",v+="<td>Base CpC:</td>",v+='<td class="cmValue" id="CMStatsBaseCPC"></td>',v+="</tr>",v+="<tr>",v+="<td>Frenzy CpC:</td>",v+='<td class="cmValue" id="CMStatsFrenzyCPC"></td>',v+="</tr>",v+="<tr>",v+="<td>Click Frenzy CpC:</td>",v+='<td class="cmValue" id="CMStatsClickFrenzyCPC"></td>',v+="</tr>",v+="<tr>",v+="<td>Frenzy + Click Frenzy CpC:</td>",v+='<td class="cmValue" id="CMStatsFrenzyClickFrenzyCPC"></td>',v+="</tr>",v+="<tr>",v+='<td colspan="2"><small>CpS = Cookies per Second, CpC = Cookies per Click</small></td>',v+="</tr>",v+="</table>",f=$(v),m.append(n,o,q,r,s,t,p),c.append(d,f,g,j,h,k,i,l,m),a.append(c),b.prepend(e),this.config.cmStatsPanel=c,this.config.cmStatsTable=f},CM.attachEfficiencyKey=function(){var a,b=$("<table />").attr({id:"CMEfficiencyTable","class":"cmTable"});0===$("#CMEfficiencyTable").length&&(a+='<tr class="cmHeader">',a+='<th colspan="2" class="cmFont">Efficiency Key:</th>',a+="</tr>",a+="<tr>",a+='<td colspan="2">BCI = Base Cost per Income (Item cost divided by CpS increase)</td>',a+="</tr>",a+="<tr>",a+='<td><span class="cmSample background-cyan"></span></td>',a+='<td class="cmValue">(Upgrades) This item has a better BCI than any building</td>',a+="</tr>",a+="<tr>",a+='<td><span class="cmSample background-purple"></span></td>',a+='<td class="cmValue">(Upgrades) This item has a worse BCI than any building</td>',a+="</tr>",a+="<tr>",a+='<td><span class="cmSample background-greyLight"></span></td>',a+='<td class="cmValue">(Upgrades) This item has not been calculated and/or cannot be calculated due to no definitive worth.</td>',a+="</tr>",a+="<tr>",a+='<td><span class="cmSample background-green"></span></td>',a+='<td class="cmValue">This item has the best BCI</td>',a+="</tr>",a+="<tr>",a+='<td><span class="cmSample background-yellow"></span></td>',a+='<td class="cmValue">This item is not the best, but it is closer to best than it is to worst</td>',a+="</tr>",a+="<tr>",a+='<td><span class="cmSample background-orange"></span></td>',a+='<td class="cmValue">This item is not the worst, but it is closer to worst than it is to best</td>',a+="</tr>",a+="<tr>",a+='<td><span class="cmSample background-red"></span></td>',a+='<td class="cmValue">This item has the worst BCI</td>',a+="</tr>",b.html(a),$("#store").after(b))},CM.removeEfficiencyKey=function(){$("#CMEfficiencyTable").length&&$("#CMEfficiencyTable").remove()},CM.attachAutoBuyPanel=function(){var a=$("<div />").attr({id:"CMAutoBuyPanel","class":"cmFont"}),b=$("<div />").attr({id:"CMAutoBuyNextPurchase","class":"cf"}),c=$("<div />").attr("id","CMAutoBuyNextPurchaseLabel").text("Next purchase:"),d=$("<div />").attr("id","CMAutoBuyNextPurchaseValue"),e=$("<div />").attr("id","CMAutoBuyTimeLeft"),f=$('<div class="cmTimerContainer cf"><div class="cmTimer"><div></div></div><div class="cmTimerCounter"></div></div>');b.append(c,d),e.append(f),a.append(b,e),$("#store").prepend(a)},CM.updateStats=function(){var a,b,c,d,e,f,g,h=this.config.settings.precision.current,i=this.getHCStats(),j=Number($("#CMXHC").val())||Number(i[2]+1),k=this.getWrinklerStats(),l=this.toTitleCase(Game.goldenCookie.last)||"-",m=Game.cookies>=this.luckyBank()?'<span class="cmHighlight">'+Beautify(this.luckyBank())+"</span>":Beautify(this.luckyBank()),n=Game.cookies<this.luckyBank()?" ("+this.formatTime((this.luckyBank()-Game.cookies)/this.effectiveCps())+")":"",o=Game.cookies>=this.luckyFrenzyBank()?'<span class="cmHighlight">'+Beautify(this.luckyFrenzyBank())+"</span>":Beautify(this.luckyFrenzyBank()),p=Game.cookies<this.luckyFrenzyBank()?" ("+this.formatTime((this.luckyFrenzyBank()-Game.cookies)/this.effectiveCps())+")":"",q="on"===this.config.settings.showMissedGC.current?Beautify(Game.missedGoldenClicks):"I'm a wimp and don't want to know",r=this.maxChainReward(),s=r?Beautify(r):"Earn "+Beautify(1e5-Math.round(Game.cookiesEarned))+" more cookies for cookie chains",t=this.requiredChainTier("bank","next",r),u=this.requiredChainTier("cps","next",r),v=this.getMissingUpgrades(),w=this.getMissingAchievements(),x=this.getMissingAchievements(!0),y="",z="",A="",B=this.luckyReward(),C=this.maxLuckyReward(),D=this.luckyFrenzyReward(),E=this.maxLuckyFrenzyReward(),F=(this.getResetCps()-this.baseCps())/this.baseCps()*100,G=this.clickTracker.ready?Math.round(100*this.clickTracker.clicksPs)/100:"Gathering data...";if(a=B>=C?'<span class="cmHighlight">'+Beautify(B)+" / "+Beautify(C)+"</span>":Beautify(B)+" / "+Beautify(C),b=D>=E?'<span class="cmHighlight">'+Beautify(D)+" / "+Beautify(E)+"</span>":Beautify(D)+" / "+Beautify(E),t!==!1&&(d=Game.cookies>t?'<span class="cmHighlight">'+Beautify(t)+"</span>":Beautify(t)+" ("+CM.formatTime((t-Game.cookies)/Game.cookiesPs,!0)+")"),u!==!1&&(e=Game.cookiesPs>u?'<span class="cmHighlight">'+Beautify(u,1)+"</span>":Beautify(u,1)),c=0===this.heavenlyToCookiesRemaining(j)?'<span class="cmHighlight">Done! (total: '+Beautify(this.heavenlyToCookies(j))+")</span>":Beautify(this.heavenlyToCookiesRemaining(j))+" ("+this.formatTime(Math.round(this.heavenlyToCookiesRemaining(j)/this.effectiveCps()),!0)+")",$("#CMStatsLuckyRequired").html(m+n),$("#CMStatsLuckyFrenzyRequired").html(o+p),$("#CMStatsLuckyReward").html(a),$("#CMStatsLuckyFrenzyReward").html(b),$("#CMStatsReindeerReward").html(Beautify(this.getReindeerReward())),$("#CMStatsMaxChainReward").html(s),$("#CMStatsBankRequiredNextChainTier").html(d||"-"),$("#CMStatsCPSRequiredNextChainTier").html(e||"-"),$("#CMStatsLastGC").html(l),$("#CMStatsAvgClicksPerSecond").html(G),$("#CMStatsMissedGC").html(q),$("#CMStatsHCCurrent").html(Beautify(i[0])+" ("+Beautify(i[1])+"%)"),$("#CMStatsHCMax").html(Beautify(i[2])+" ("+Beautify(i[3])+"%)"),$("#CMStatsCPSReset").html(Beautify(this.getResetCps())+" ("+Beautify(F,h)+"% increase)"),$("#CMStatsHCCookiesToNext").html(Beautify(i[4])+" / "+Beautify(i[5])),$("#CMStatsHCTimeToNext").html(i[6]),$("#CMStatsHCCookiesToX").html(c),$("#CMStatsWrinklersSucked").html(Beautify(k[0])),$("#CMStatsWrinklersReward").html(Beautify(k[1])),$("#CMStatsBaseCPS").html(Beautify(this.baseCps(),1)),$("#CMStatsEffectiveCPS").html(Beautify(this.effectiveCps(),1)),$("#CMStatsFrenzyCPS").html(Beautify(7*this.baseCps(),1)),$("#CMStatsElderFrenzyCPS").html(Beautify(666*this.baseCps(),1)),$("#CMStatsBaseCPC").html(Beautify(this.baseCpc())),$("#CMStatsFrenzyCPC").html(Beautify(7*this.baseCpc())),$("#CMStatsClickFrenzyCPC").html(Beautify(777*this.baseCpc())),$("#CMStatsFrenzyClickFrenzyCPC").html(Beautify(777*this.baseCpc()*7)),y+='<table class="cmTable">',v.length)for(f=0;f<v.length;f++)y+="<tr><td>"+v[f]+'</td><td class="cmValue">'+Game.Upgrades[v[f]].desc+"</td></tr>";else y+='<tr><td colspan="2">All upgrades purchased. Well done!</td></tr>';if(y+="</table>",z+='<table class="cmTable">',w.length)for(f=0;f<w.length;f++)z+="<tr><td>"+w[f]+'</td><td class="cmValue">'+Game.Achievements[w[f]].desc+"</td></tr>";else z+='<tr><td colspan="2">All achievements unlocked. Go you!</td></tr>';if(z+="</table>",A+='<table class="cmTable">',x.length)for(g=0;g<x.length;g++)A+="<tr><td>"+x[g]+'</td><td class="cmValue">'+Game.Achievements[x[g]].desc+"</td></tr>";else A+='<tr><td colspan="2">All shadow achievements unlocked. Go outside!</td></tr>';A+="</table>",$("#CMUpgCont").html(y),$("#CMAchCont").html(z),$("#CMShaCont").html(A)},CM.attachTimerPanel=function(){{var a=$("<div />").attr({id:"CMTimerPanel","class":"cmFont"}),b=this.config.ccSectionLeft;this.config.cmTimerResolution}0===$("#CMTimerPanel").length&&(b.append(a),this.config.cmTimerPanel=a)},CM.populateTimerPanel=function(){var a,b,c={},d=this.config.settings,e=this.config.cmTimerSettings;this.config.cmTimerPanel.empty(),this.timers={},c.gc=d.showGCTimer.current,c.sp=d.showSPTimer.current,c.frenzy=d.showFrenzyTimer.current,c.elderFrenzy=d.showElderFrenzyTimer.current,c.clickFrenzy=d.showClickFrenzyTimer.current,c.clot=d.showClotTimer.current,c.pledge=d.showPledgeTimer.current,"off"!==d.popWrinklersAtInterval.current&&(c.wrinklers="on");for(a in c)"on"===c[a]&&(CM.timers[a]=new CM.Timer(a,e[a].label));for(b in this.timers)CM.config.cmTimerPanel.append(CM.timers[b].create())},CM.updateTimers=function(){var a,b={gc:0===Game.goldenCookie.life,sp:0===Game.seasonPopup.life&&"christmas"===Game.season,frenzy:Game.frenzy>0&&7===Game.frenzyPower,clickFrenzy:Game.clickFrenzy>0,elderFrenzy:Game.frenzy>0&&666===Game.frenzyPower,clot:Game.frenzy>0&&.5===Game.frenzyPower,pledge:Game.pledgeT>0,wrinklers:CM.popWrinklersTimeRelative>0};for(a in b)this.timers.hasOwnProperty(a)&&(b[a]?(this.timers[a].update().show(),this.hideOtherTimers(a)):this.timers[a].hide())},CM.hideOtherTimers=function(a){var b=this.config.cmTimerSettings[a],c=b.hasOwnProperty("hide")?b.hide:null;c&&c.length>0&&c.forEach(function(a){CM.timers.hasOwnProperty(a)&&CM.timers[a].hide()})},CM.attachDisplayGCTimer=function(){var a=(this.config.ccGoldenCookie,this.config.cmGCOverlay||$("<div />").attr({id:"CMGCOverlay","class":"cmFont"}));0===$("#CMGCOverlay").length&&(this.config.ccBody.append(a),this.config.cmGCOverlay=a)},CM.updateDisplayGCTimer=function(){var a=this.config.ccGoldenCookie,b=this.config.cmGCOverlay,c=Math.round(Game.goldenCookie.life/Game.fps);Game.goldenCookie.life>0?b.css({top:a.css("top"),left:a.css("left"),opacity:a.css("opacity")}).text(c).show():b.hide()},CM.autoClickPopups=function(){var a=this.config.settings.autoClickPopups.current;("gc"===a||"all"===a)&&Game.goldenCookie.life>0&&Game.goldenCookie.click(),("sp"===a||"all"===a)&&Game.seasonPopup.life>0&&Game.seasonPopup.click()},CM.showVisualAlerts=function(){var a=this.config.cmOverlay||$("<div />").attr("id","CMOverlay"),b=this.config.ccBody,c=(this.config.ccGoldenCookie,this.config.ccSeasonPopup,this.config.cmVisualGCNotified),d=this.config.cmVisualSPNotified,e=this.config.settings.visualAlerts.current;0===$("#CMOverlay").length&&(b.append(a),this.config.cmOverlay=a),("gc"===e||"all"===e)&&(Game.goldenCookie.life>0?c||(a.show().fadeOut(500),this.config.cmVisualGCNotified=!0):this.config.cmVisualGCNotified=!1),("sp"===e||"all"===e)&&(Game.seasonPopup.life>0?d||(a.show().fadeOut(500),this.config.cmVisualSPNotified=!0):this.config.cmVisualSPNotified=!1)},CM.removeVisualAlerts=function(){this.config.cmVisualGCNotified=!1,this.config.cmVisualSPNotified=!1,$("#CMOverlay").remove()},CM.playAudioAlerts=function(){var a=(this.config.ccBody,this.config.ccGoldenCookie,this.config.ccSeasonPopup,this.config.cmGCAudioObject),b=this.config.cmSPAudioObject,c=this.config.cmAudioGCNotified,d=this.config.cmAudioSPNotified,e=this.config.settings.audioAlerts.current,f=this.config.settings.audioVolume.current;("gc"===e||"all"===e)&&(Game.goldenCookie.life>0?c||(a.volume=f,a.play(),setTimeout(function(){a.load()},2500),this.config.cmAudioGCNotified=!0,this.testAudioObject(this.config.cmGCAudioObject)||this.message("<strong>Error:</strong> Could not load Golden Cookie audio alert. If you are using a custom alert, please make sure you have specified a valid URL.","error")):this.config.cmAudioGCNotified=!1),("sp"===e||"all"===e)&&(Game.seasonPopup.life>0?d||(b.volume=f,b.play(),setTimeout(function(){b.load()},2500),this.config.cmAudioSPNotified=!0,this.testAudioObject(this.config.cmSPAudioObject)||this.message("<strong>Error:</strong> Could not load Reindeer audio alert. If you are using a custom alert, please make sure you have specified a valid URL.","error")):this.config.cmAudioSPNotified=!1)},CM.autoBuyPledge=function(){var a=Game.Upgrades["Elder Pledge"],b=a.isInStore(),c=a.getPrice(),d=Game.cookies;b&&d>c&&(a.buy(),this.popup("Bought Elder Pledge!","notice"))},CM.AddPopWrinklersButton=function(){var a=$("<button />").attr({id:"CMPopWrinklers",type:"button"}).text("Pop all Wrinklers");$("#cookieAnchor").append(a)},CM.popWrinklersAfterXTime=function(){var a=this.config.settings.popWrinklersAtInterval.current,b="off"!==a?a:null;CM.popWrinklerTimer&&(clearTimeout(CM.popWrinklerTimer),CM.popWrinklersTime=null,CM.popWrinklersTimeRelative=null),b&&(CM.popWrinklersTimeRelative=Number(b),CM.popWrinklersTime=(new Date).getTime()+Number(b),CM.popWrinklerTimer=setTimeout(function c(){var a=CM.getWrinklerStats()[1];CM.popWrinklersTimeRelative=Number(b),CM.popWrinklersTime=(new Date).getTime()+Number(b),CM.wrinklersExist()&&a&&(Game.CollectWrinklers(),CM.message("<strong>Popped all Wrinklers.</strong> Rewarded "+Beautify(a)+" cookies.","notice")),CM.popWrinklerTimer=setTimeout(c,b)},b))},CM.updateTitleTicker=function(){var a=Math.round((Game.goldenCookie.maxTime-Game.goldenCookie.time)/Game.fps),b=Math.round((Game.seasonPopup.maxTime-Game.seasonPopup.time)/Game.fps),c=Game.goldenCookie.life>0?"G ("+Math.round(Game.goldenCookie.life/Game.fps)+")":a,d=Game.seasonPopup.life>0?"R":b,e=Beautify(Game.cookies),f="christmas"===Game.season?" | "+d:" ";document.title=c+f+" - "+e+" cookies"},CM.setTrueNeverclick=function(){"on"===this.config.settings.trueNeverclick.current?Game.HasAchiev("True Neverclick")?this.message("<strong>Warning:</strong> True Neverclick is already unlocked. Big Cookie will remain clickable.","warning"):(Game.cookieClicks>0&&this.message("<strong>Warning:</strong> True Neverclick not possible as Big Cookie has already been clicked "+Game.cookieClicks+" times this session.","warning"),$("#bigCookie")[0].removeEventListener("click",Game.ClickCookie),$("#bigCookie").unbind("click"),$("#bigCookie").click(function(){Game.HasAchiev("True Neverclick")?Game.ClickCookie():CM.popup("Click prevented!","warning")})):($("#bigCookie")[0].removeEventListener("click",Game.ClickCookie),$("#bigCookie").unbind("click"),AddEvent(l("bigCookie"),"click",Game.ClickCookie))},CM.startAutoClicker=function(){this.clearAutoClicker(),this.autoClicker=setInterval(function(){Game.ClickCookie()},1e3/CM.config.settings.autoClickSpeed.current)},CM.clearAutoClicker=function(){this.autoClicker&&clearInterval(this.autoClicker)},CM.manageAutoClicker=function(){var a=this.config.settings.autoClick.current,b=Game.clickFrenzy>0,c=Game.frenzy>0&&666===Game.frenzyPower,d=Game.frenzy>0&&Game.frenzyPower>1;"allFrenzies"===a?d||b?this.startAutoClicker():this.clearAutoClicker():"clickFrenzies"===a&&(b||c?this.startAutoClicker():this.clearAutoClicker())},CM.preventClickBleed=function(){$("#goldenCookie")[0].onclick=null,$("#seasonPopup")[0].onclick=null,$("#goldenCookie").click(function(a){a.stopPropagation(),Game.goldenCookie.click()}),$("#seasonPopup").click(function(a){a.stopPropagation(),Game.seasonPopup.click()})},CM.clickSanta=function(){var a,b,c=Math.pow(Game.santaLevel+1,Game.santaLevel+1),d=[];if(Game.cookies>c&&Game.santaLevel<14){Game.Spend(c),Game.santaLevel=(Game.santaLevel+1)%15,14===Game.santaLevel&&(Game.Unlock("Santa's dominion"),Game.Popup("You are granted<br>Santa's dominion.")),Game.santaTransition=1;for(b in Game.santaDrops)Game.HasUnlocked(Game.santaDrops[b])||d.push(Game.santaDrops[b]);a=choose(d),a&&(Game.Unlock(a),Game.Popup("You find a present which contains...<br>"+a+"!")),Game.santaLevel>=6&&Game.Win("Coming to town"),Game.santaLevel>=14&&Game.Win("All hail Santa")}},CM.startLogging=function(){var a=CM.config.cmStatsLogStart||localStorage.getItem("CMStatsStartTime");a||(a=(new Date).getTime()),localStorage.setItem("CMStatsStartTime",a),CM.config.cmStatsLogStart=a,CM.logData(),CM.config.cmStatsLogTimer=setInterval(function(){CM.logData()},3e4),localStorage.setItem("CMStatsLoggingActive","true"),CM.popup("Logging data!","notice"),$("#CMChartY").hide(),$("#CMChartN").show()},CM.stopLogging=function(){this.config.cmStatsLogTimer&&(clearInterval(this.config.cmStatsLogTimer),localStorage.setItem("CMStatsLoggingActive","false"),this.popup("Stopped logging data!","notice")),$("#CMChartN").hide(),$("#CMChartY").show()},CM.clearLogSesion=function(){this.config.cmStatsData=null,localStorage.removeItem("CMStatsData"),this.config.cmStatsLogStart=(new Date).getTime(),localStorage.setItem("CMStatsStartTime",this.config.cmStatsLogStart),this.config.cmStatsChart.clearChart(),this.popup("Log cleared!","notice")},CM.logData=function(){var a=this.config.cmStatsLogStart,b=(new Date).getTime(),c=this.formatTime(Math.round((b-a)/1e3),!0),d=this.config.cmStatsData,e=[Math.round(10*this.baseCps())/10,Math.round(10*this.effectiveCps())/10];d||(d=JSON.parse(localStorage.getItem("CMStatsData"))||{}),d[c]=e,localStorage.setItem("CMStatsData",JSON.stringify(d)),this.config.cmStatsData=d,this.config.cmStatsPanel.is(":visible")&&this.drawChart()},CM.drawChart=function(){var a,b=CM.config.cmStatsData||JSON.parse(localStorage.getItem("CMStatsData")),c=[["Time","CpS","Effective CpS"]],d={chartArea:{width:"100%",height:"100%"},legend:{position:"in",textStyle:{color:"#FFF"}},axisTitlesPosition:"in",hAxis:{textPosition:"none",textStyle:{color:"#DDD"}},vAxis:{logScale:!0,baseline:0,gridlines:{color:"#444"},textPosition:"in",textStyle:{color:"#DDD"}},backgroundColor:"transparent",fontSize:"12"};b&&($.each(b,function(a,b){c.push([a,b[0],b[1]])}),a=google.visualization.arrayToDataTable(c),CM.config.cmStatsChart||(CM.config.cmStatsChart=new google.visualization.LineChart(document.getElementById("CMChart"))),CM.config.cmStatsChart.draw(a,d))},CM.downloadCSV=function(){var a,b,c,d,e,f=this.config.cmStatsData||JSON.parse(localStorage.getItem("CMStatsData")),g=[["Time","CpS","Effective  CpS"]],h=[];if(f){for(b in f)g.push([b.replace(new RegExp(",","g"),";"),f[b][0],f[b][1]]);for(d=0,e=g.length;e>d;++d)h.push(g[d].join(","));a=h.join("%0A"),c=document.createElement("a"),c.href="data:attachment/csv,"+a,c.target="_blank",c.download="stats.csv",document.body.appendChild(c),c.click()}else CM.message("<strong>Error:</strong> No logged data available to download!","error")},CM.cleanUI=function(a){function b(){Game.Background.canvas.width=Game.Background.canvas.parentNode.offsetWidth,Game.Background.canvas.height=Game.Background.canvas.parentNode.offsetHeight,Game.LeftBackground.canvas.width=Game.LeftBackground.canvas.parentNode.offsetWidth,Game.LeftBackground.canvas.height=Game.LeftBackground.canvas.parentNode.offsetHeight}var c="cleanUI",d=this.config.ccBody;a?d.addClass(c):d.removeClass(c),setTimeout(b,1e3)},CM.changeFont=function(a){var b=this.config.ccBody;b.removeClass("serif sansserif"),"default"!==a&&b.addClass(a)},CM.applyUserSettings=function(){var a=this.config,b=this.config.settings,c=localStorage.getItem("CMStatsLoggingActive");this.cleanUI("on"===b.cleanUI.current),this.changeFont(b.changeFont.current),"on"===b.showAllUpgrades.current?a.ccBody.addClass("cmShowAllUpgrades"):a.ccBody.removeClass("cmShowAllUpgrades"),"on"===b.hideNativeTimers.current?a.ccBody.addClass("cmHideNativeTimers"):a.ccBody.removeClass("cmHideNativeTimers"),"on"===b.hideBuildingInfo.current?a.ccBody.addClass("cmHideBuildingInfo"):a.ccBody.removeClass("cmHideBuildingInfo"),this.populateTimerPanel(),"top"===b.timerBarPosition.current?a.ccBody.addClass("cmTimerTop"):a.ccBody.removeClass("cmTimerTop"),"off"!==b.popWrinklersAtInterval.current?this.popWrinklersAfterXTime():clearTimeout(CM.popWrinklerTimer),"on"===b.showGCCountdown.current?this.attachDisplayGCTimer():$("#CMGCOverlay").remove(),"off"===b.visualAlerts.current&&this.removeVisualAlerts(),this.config.cmGCActualAlertURL=""!==b.customGCAlert.current?b.customGCAlert.current:this.config.cmGCAudioAlertURL,this.config.cmSPActualAlertURL=""!==b.customSPAlert.current?b.customSPAlert.current:this.config.cmSPAudioAlertURL,"off"!==b.audioAlerts.current&&(this.config.cmGCAudioObject=new Audio(this.config.cmGCActualAlertURL),this.config.cmSPAudioObject=new Audio(this.config.cmSPActualAlertURL)),"on"===b.showEfficiencyKey.current?this.attachEfficiencyKey():this.removeEfficiencyKey(),"on"===b.highVisibilityCookie.current?a.ccBody.addClass("cmHighVisCookie"):a.ccBody.removeClass("cmHighVisCookie"),"on"===b.increaseClickArea.current?a.ccBody.addClass("cmLargeClickArea"):a.ccBody.removeClass("cmLargeClickArea"),"on"===b.autoClick.current?this.startAutoClicker():this.clearAutoClicker(),"on"===b.enableLogging.current?(a.cmStatsLogTimer?($("#CMChartY").hide(),$("#CMChartN").show()):"undefined"==typeof google.visualization?"true"===c?google.load("visualization","1",{callback:CM.startLogging,packages:["corechart"]}):(google.load("visualization","1",{callback:CM.drawChart,packages:["corechart"]}),$("#CMChartN").hide(),$("#CMChartY").show()):"true"===c?this.startLogging():(this.drawChart(),$("#CMChartN").hide(),$("#CMChartY").show()),$("#CMChartCont").show()):(this.stopLogging(),a.cmStatsData=null,localStorage.setItem("CMStatsLoggingActive","false"),$("#CMChartCont").hide()),"on"===b.colorBlind.current?a.ccBody.addClass("cmCB"):a.ccBody.removeClass("cmCB"),this.setTrueNeverclick(),this.trueCps=new this.TrueCps,this.trueCps.start(30,60*this.config.settings.trueCpsAverage.current),this.clickTracker=new this.ClickTracker,this.clickTracker.start(60,60*this.config.settings.clickingAverage.current),"on"===b.autoBuy.current?(this.autoBuyer.init(),$("#CMAutoBuyPanel").fadeIn(200)):(this.autoBuyer.stop(),$("#CMAutoBuyPanel").fadeOut(200)),Game.RefreshStore(),Game.RebuildUpgrades()
},CM.saveUserSettings=function(){var a=this.config.settings,b=new Date,c={},d="";$.each(a,function(a){c[a]=this.current}),d=$.param(c).replace(/=/g,":").replace(/&/g,"|"),b.setFullYear(b.getFullYear()+5),document.cookie="CMSettings="+d+";expires="+b.toGMTString()+";",-1===document.cookie.indexOf("CMSettings")?this.popup("Error: Could not save settings!","error"):this.popup("Settings saved successfully!","notice")},CM.loadUserSettings=function(){var a=this.config.settings,b=/(?:(?:^|.*;\s*)CMSettings\s*\=\s*([^;]*).*$)|^.*$/,c=document.cookie.replace(b,"$1"),d=[],e=[];c&&(d=c.split("|"),$.each(d,function(){e=this.split(":"),a.hasOwnProperty(e[0])&&(("customGCAlert"===e[0]||"customSPAlert"===e[0])&&(e[1]=decodeURIComponent(e[1])),a[e[0]].current=e[1])}))},CM.setEvents=function(){var a=this,b=this.config.ccGame,c=this.config.cmStatsPanel,d=this.config.cmSettingsPanel,e=this.config.ccSectionLeft,f=$("#CMSettingsTables"),g=this.getHCStats()[2]+1,h=this.heavenlyToCookiesRemaining(g);f.on("change","input, select",function(){var b,c=$(this).attr("name");$(this).is("select")?b=$(this).find(":selected").val():$(this).is('[type="checkbox"]')?b=$(this).prop("checked")?"on":"off":($(this).is('[type="range"]')||$(this).is('[type="text"]'))&&(b=$(this).val()),$(this).is('[type="range"]')&&$(this).siblings(".currentValue").text($(this).val()),a.config.settings[c].current=b}),$("#CMSettingsSave").click(function(){a.saveUserSettings(),a.applyUserSettings()}),$("#CMSettingsPause").click(function(){alert("Game paused. Click OK to resume.")}),$("#statsButton, #prefsButton, #logButton").click(function(){$("#rows").show(),$("#CMStatsPanel, #CMSettingsPanel").hide()}),$("#CMStatsPanelButton").click(function(){c.is(":hidden")?(a.updateStats(),c.show(),d.hide(),$("#rows").hide(),b.addClass("onCMMenu"),"on"===a.config.settings.enableLogging.current&&a.drawChart()):(c.hide(),d.hide(),$("#rows").show(),b.removeClass("onCMMenu")),$("#menu").empty(),b.removeClass("onMenu"),Game.onMenu=""}),$("#CMSettingsPanelButton").click(function(){d.is(":hidden")?(d.show(),c.hide(),$("#rows").hide(),b.addClass("onCMMenu")):(d.hide(),c.hide(),$("#rows").show(),b.removeClass("onCMMenu")),$("#menu").empty(),b.removeClass("onMenu"),Game.onMenu=""}),e.hover(function(){a.wrinklersExist()&&$("#CMPopWrinklers").fadeIn(200)},function(){$("#CMPopWrinklers").fadeOut(200)}),$("#CMPopWrinklers").click(function(){Game.CollectWrinklers(),$("#CMPopWrinklers").hide()}),this.config.ccBody.on("mousedown","#CMGCOverlay",function(){Game.goldenCookie.click(),$("#CMGCOverlay").hide()}),$("#CMChartY").click(function(){a.startLogging(),$(this).hide(),$("#CMChartN").show()}),$("#CMChartN").click(function(){a.stopLogging(),$(this).hide(),$("#CMChartY").show()}),$("#CMChartC").click(function(){a.clearLogSesion()}),$("#CMChartD").click(function(){a.downloadCSV()}),$("#CMToggleUpg").click(function(){$("#CMUpgCont").toggle()}),$("#CMToggleAch").click(function(){$("#CMAchCont").toggle()}),$("#CMToggleSha").click(function(){$("#CMShaCont").toggle()}),$("#CMXHC").val(g),$("#CMStatsHCCookiesToX").html(Beautify(h)),$("#CMXHC").keyup(function(){var a=Number($(this).val()),b=Beautify(CM.heavenlyToCookiesRemaining(a)),c=Beautify(CM.heavenlyToCookies(a));$("#CMStatsHCCookiesToX").html(b+" (total: "+c+")")}),$("#CMMessageBar").hover(function(){$(this).children().length>3&&$("#CMMessageBarDismissAll").fadeIn(200)},function(){$("#CMMessageBarDismissAll").fadeOut(200)}),$("#CMMessageBar").on("click",".cmContainer",function(){$(this).fadeTo(100,0,function(){$(this).slideUp(100,function(){$(this).remove()})})}),$("#CMMessageBarDismissAll").click(function(){$(".cmContainer").fadeTo(100,0,function(){$(this).remove()}),$(this).fadeOut(200)})},CM.suicide=function(){alert("This kills the CookieMaster.")},CM.message=function(a,b){var c=b?"cm"+this.toTitleCase(b):"cmNotice",d=$("<div />").attr("class","cmContainer"),e=$("<div />").attr({"class":"cmMessage "+c}),f=$("<div />").attr("class","cmDismiss").text("x");e.html(a),d.append(e,f),this.config.cmMessageBar.prepend(d),d.slideDown(300,function(){$(this).find(".cmMessage").fadeTo(300,1)})},CM.makeTooltip=function(a){a.desc+=CM.makeTooltipHtml(a),Game.foolDescs[a.name]+=cmTooltip,Game.RebuildUpgrades()},CM.makeTooltipHtml=function(a){var b=a.identifier();return cmTooltip='<div class="cm-tooltip__contents" id="'+b+'"></div><div class="cm-tooltip__warnings" id="'+b+'note_div"><div id="'+b+'note_div_warning" class="cmTooltipWarningLucky"><strong>Lucky deficit if purchased:</strong><br /><span id="'+b+'warning_amount"></span></div><div id="'+b+'note_div_caution" class="cmTooltipWarningLuckyFrenzy"><strong>Lucky+Frenzy deficit if purchased:</strong><br /><span id="'+b+'caution_amount"></span></div><div id="'+b+'note_div_chain" class="cmTooltipWarningChain"><strong>Current Chain tier deficit if purchased:</strong><br /><span id="'+b+'chain_amount"></span></div></div>'},CM.updateTooltip=function(a,b){var c,d=[a.getWorth(!0),a.getBaseCostPerIncome(),a.getTimeLeft()],e=CME.getThresholdAlerts(a),f="#"+a.identifier(),g=$(f),h=d[2]>0?CM.formatTime(d[2],!0):'<span class="cmHighlight">Done!</span>';a.matches(a.identifier())||this.makeTooltip(a),1===g.length&&"none"!==g.css("display")&&(c='<table class="cmTable">',"upgrade"===a.getType()&&a.isClickingRelated()&&(c+='<tr><td>Bonus CpC:</td><td class="cmValue text-'+b[1]+'">'+Beautify(a.getClickingWorth(),1)+"</td></tr>"),c+='<tr><td>Bonus Income:</td><td class="cmValue">'+Beautify(d[0],1)+'</td></tr><tr><td>BCI:</td><td class="cmValue text-'+b[0]+'">'+Beautify(d[1],1)+'</td></tr><tr><td>Time Left:</td><td class="cmValue text-'+b[1]+'">'+h+"</td></tr></table>",g.attr("class","cm-tooltip__contents border-"+b[0]).html(c),$(f+"warning_amount").html(Beautify(e[0])+" ("+CME.getTimeToCookies(e[0])+")"),$(f+"caution_amount").html(Beautify(e[1])+" ("+CME.getTimeToCookies(e[1])+")"),$(f+"chain_amount").html(Beautify(e[2])+" ("+CME.getTimeToCookies(e[2])+")"),"on"===this.config.settings.showDeficitStats.current?($(f+"note_div_warning").toggle(e[0]>0),$(f+"note_div_caution").toggle(e[1]>0),$(f+"note_div_chain").toggle(e[2]>0)):($(f+"note_div_warning").hide(),$(f+"note_div_caution").hide(),$(f+"note_div_chain").hide()),this.tooltipLastObjectId=f)},CM.setupTooltips=function(){this.updateTooltips(),Game.RebuildUpgrades()},CM.setupDynamicTooltips=function(){Game.ObjectsById.forEach(function(a){_tooltip=a.tooltip,a.tooltip=function(){return setTimeout(function(){CM.manageBuildingTooltip(a)},1),_tooltip.apply(a)}})},CM.updateTooltips=function(a){"undefined"==typeof a&&(a="all"),("all"===a||"upgrades"===a)&&Game.UpgradesById.forEach(function(a){CM.manageUpgradeTooltips(a)}),("all"===a||"objects"===a)&&Game.ObjectsById.forEach(function(a){CM.manageBuildingTooltip(a)})},CM.manageUpgradeTooltips=function(a){var b=a.getColors(),c="#"+a.identifier();return a.isInStore()?($("#upgrade"+Game.UpgradesInStore.indexOf(a)).html('<div class="cmUpgrade background-'+b[0]+'"></div>'),this.updateTooltip(a,b)):($(c+"note_div_warning").hide(),$(c+"note_div_caution").hide(),void $(c+"note_div_chain").hide())},CM.manageBuildingTooltip=function(a){var b=a.getColors(),c=b[0];return $(".price","#product"+a.id).attr("class","price text-"+c),this.updateTooltip(a,b)},CM.checkForUpdate=function(){var a=this.config.version,b=this.config.cmVersionNotified,c=this.config.cmChangelogURL,d=this.config.cmVersionURL;$.ajax({url:d,cache:!1,dataType:"json"}).done(function(d){var e=d.version;-1===CM.versionCompare(a,e)&&b!==e&&(CM.message("<strong>New version of CookieMaster available! (v."+e+')</strong><br /><em>Bookmark users:</em> Save and refresh to update.<br /><em>Chrome extension users:</em> Chrome auto-updates your plugins periodically, but if you really want the new version right now, check the "Developer mode" box in your Extensions page, then click "Update Extensions Now".<br /><a href="'+c+'" target="_blank">See what\'s new</a> (opens in new tab).',"notice"),CM.config.cmVersionNotified=e)}).error(function(){CM.message("<strong>Error:</strong> Could not check for update :(","error")})};var gameReadyStateCheckInterval=setInterval(function(){"object"==typeof Game&&Game.ready&&(clearInterval(gameReadyStateCheckInterval),Game.Achievement.prototype.getDescribedInteger=CMEO.getDescribedInteger,Game.Achievement.prototype.matches=CMEO.matches,Game.Object.prototype.getBaseCostPerIncome=CMEO.getBaseCostPerIncome,Game.Object.prototype.getColors=CMEO.getColors,Game.Object.prototype.getComparativeInfos=CMEO.getComparativeInfos,Game.Object.prototype.getReturnInvestment=CMEO.getReturnInvestment,Game.Object.prototype.getTimeLeft=CMEO.getTimeLeft,Game.Object.prototype.getType=CMEO.getTypeOf,Game.Object.prototype.getWorth=CMEO.getWorthOf,Game.Object.prototype.identifier=CMEO.identifier,Game.Object.prototype.matches=CMEO.matches,Game.Object.prototype.simulateToggle=CMEO.simulateBuildingToggle,Game.Upgrade.prototype.getBaseCostPerIncome=CMEO.getBaseCostPerIncome,Game.Upgrade.prototype.getColors=CMEO.getColors,Game.Upgrade.prototype.getComparativeInfos=CMEO.getComparativeInfos,Game.Upgrade.prototype.getDescribedInteger=CMEO.getDescribedInteger,Game.Upgrade.prototype.getReturnInvestment=CMEO.getReturnInvestment,Game.Upgrade.prototype.getTimeLeft=CMEO.getTimeLeft,Game.Upgrade.prototype.getType=CMEO.getTypeOf,Game.Upgrade.prototype.getWorth=CMEO.getWorthOf,Game.Upgrade.prototype.getClickingWorth=CMEO.getClickingWorth,Game.Upgrade.prototype.identifier=CMEO.identifier,Game.Upgrade.prototype.matches=CMEO.matches,Game.Upgrade.prototype.simulateToggle=CMEO.simulateUpgradeToggle,Game.Upgrade.prototype.isInStore=CMEO.isInStore,Game.Upgrade.prototype.isClickingRelated=CMEO.isClickingRelated,window.Beautify=function(a,b){var c=b||0;return CM.largeNumFormat(a,c)},CM.replaceNative("Logic",{"if (Game.T%(Game.fps*2)==0) document.title=Beautify(Game.cookies)+' '+(Game.cookies==1?'cookie':'cookies')+' - Cookie Clicker';":""}),CM.replaceNative("Reset",{"if (!bypass":"CM.clearAutoClicker();if (!bypass","var cookiesForfeited":"if(CM.config.settings.autoClick.current === 'on') {setTimeout(function(){CM.startAutoClicker();}, 1000);} var cookiesForfeited"},"bypass, hard"),Game.tooltip.update=CM.appendToNative(Game.tooltip.update,CME.controlTooltipPosition),window.Audio=function(a){return a&&-1!==a.indexOf("soundjay")?(CM.message("<strong>Error:</strong> Sorry, no sounds hotlinked from soundjay.com.","error"),!1):new realAudio(a)},CM.init())},10);